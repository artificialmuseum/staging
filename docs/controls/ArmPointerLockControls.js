import{au as e,a5 as t,an as o,aj as n,ae as i,$ as s}from"../vendor.js";const r=new e(0,0,0,"YXZ"),h=new t,a={type:"change"},c={type:"lock"},l={type:"unlock"},d=Math.PI/2;class m extends o{constructor(e,t){super(),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this._onMouseMove=k.bind(this),this._onPointerlockChange=y.bind(this),this._onPointerlockError=u.bind(this),this.connect()}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}getObject(){return this.camera}getDirection(e){return e.set(0,0,-1).applyQuaternion(this.camera.quaternion)}moveForward(e){const t=this.camera;h.setFromMatrixColumn(t.matrix,0),h.crossVectors(t.up,h),t.position.addScaledVector(h,e)}moveRight(e){const t=this.camera;h.setFromMatrixColumn(t.matrix,0),t.position.addScaledVector(h,e)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}}function k(e){if(!1===this.isLocked)return;const t=e.movementX||e.mozMovementX||e.webkitMovementX||0,o=e.movementY||e.mozMovementY||e.webkitMovementY||0,n=this.camera;r.setFromQuaternion(n.quaternion),r.y-=.002*t*this.pointerSpeed,r.x-=.002*o*this.pointerSpeed,r.x=Math.max(d-this.maxPolarAngle,Math.min(d-this.minPolarAngle,r.x)),n.quaternion.setFromEuler(r),this.dispatchEvent(a)}function y(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(c),this.isLocked=!0):(this.dispatchEvent(l),this.isLocked=!1)}function u(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}class p extends m{constructor(e,o,r,h){super(e,o);var{lookat:a={},pointerLockControls:c}=r;this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onLock=this.onLock.bind(this),this.onUnlock=this.onUnlock.bind(this),this.keyboard={},this.rayOrigin=new t,this.rayDirection=new t(0,-1,0),this.velocity=0,this.config=n(c,{targets:[],speed:.5,gravity:9.8,fallSpeed:.01}),Object.entries(this.config).forEach((e=>{var[t,o]=e;this[t]=o})),this.targets=[],this.config.targets.length&&(this.targets=this.config.targets.map((e=>h.model.getObjectByName(e))).filter((e=>e)),this.targets.length&&(this.floorRay=new i));var{x:l=0,y:d=0,z:m=0}=a,k=new t(l,d,m);e.lookAt(k),this.lockMenuPanel=s.create("div",{parent:document.body,style:{position:"fixed",left:"50%",top:"50%",fontSize:"2em",zIndex:5e10},children:[s.create("button",{style:{color:"#000",backgroundColor:"green"},innerText:"testing",on:{click:()=>this.lock()}})]}),s.on(this,"lock",this.onLock),s.on(this,"unlock",this.onUnlock),s.on(document,"keydown",this.onKeyDown,!1),s.on(document,"keyup",this.onKeyUp,!1)}onLock(){this.lockMenuPanel.style.display="none"}onUnlock(){this.lockMenuPanel.style.display="block"}onKeyDown(e){var{code:t,repeat:o}=e;o||("KeyW"!==t&&"ArrowUp"!==t||(this.keyboard.w=!0),"KeyA"!==t&&"ArrowLeft"!==t||(this.keyboard.a=!0),"KeyS"!==t&&"ArrowDown"!==t||(this.keyboard.s=!0),"KeyD"!==t&&"ArrowRight"!==t||(this.keyboard.d=!0))}onKeyUp(e){var{code:t}=e;"KeyW"!==t&&"ArrowUp"!==t||(this.keyboard.w=!1),"KeyA"!==t&&"ArrowLeft"!==t||(this.keyboard.a=!1),"KeyS"!==t&&"ArrowDown"!==t||(this.keyboard.s=!1),"KeyD"!==t&&"ArrowRight"!==t||(this.keyboard.d=!1)}unspawn(){s.remove(this.lockMenuPanel),s.off(this,"lock",this.onLock),s.off(this,"unlock",this.onUnlock),s.off(document,"keydown",this.onKeyDown,!1),s.off(document,"keyup",this.onKeyUp,!1)}updateRayCaster(e){this.floorRay.set(this.camera.position,this.rayDirection);var t=this.floorRay.intersectObjects(this.targets);t.length&&t.filter((e=>e.object.visible)).forEach((e=>{var t=e.point.y+1.7;this.camera.position.y!==t&&(this.camera.position.y=t)}))}update(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.targets.length&&this.updateRayCaster(e),this.keyboard){var{speed:t}=this.config;this.keyboard.w&&this.moveForward(t*e),this.keyboard.a&&this.moveRight(-t*e),this.keyboard.s&&this.moveForward(-t*e),this.keyboard.d&&this.moveRight(t*e)}}}export{p as ArmPointerLockControls};
