import{aj as t}from"./vendor.js";class o{constructor(o){this.config=t(o,{host:"127.0.0.1",port:8888,protocol:"ws",scene:void 0}),this.socket=void 0,this.tryConnectWaitTimeBase=500,this.tryConnectWaittime=500,this.tryConnect=this.tryConnect.bind(this),this.tryConnect()}tryConnect(){var{host:t,port:o,protocol:e,scene:n={}}=this.config;if(!this.socket)try{var s="".concat(e,"://").concat(t,":").concat(o);console.log({wsUrl:s,protocol:e,host:t,port:o}),this.socket=new WebSocket(s),this.socket&&(null!=n&&n.onOpen?this.socket.onopen=function(){return n.onOpen(...arguments)}:this.socket.onopen=function(){return console.log(...arguments)},null!=n&&n.onMessage&&(this.socket.onmessage=function(){return n.onMessage(...arguments)}),null!=n&&n.onClose?this.socket.onclose=function(){return n.onClose(...arguments)}:this.socket.onclose=function(){return console.log(...arguments)},this.socket.onerror=console.error)}catch(t){this.socket=void 0,console.error("Error connecting to websocket server:",t,"retrying in","".concat(this.tryConnectWaittime,"ms")),setTimeout(this.tryConnect,this.tryConnectWaittime),this.tryConnectWaittime+=this.tryConnectWaitTimeBase}}send(t){1===this.socket.readyState?(console.log("WS send",this.socket),this.socket.send(t)):console.log("no socket found")}close(){setTimeout((()=>this.tryConnect()),500)}}export{o as WS};
