import{a$ as a,aj as t,ai as e}from"../vendor.js";class i{constructor(a){var{artifact:t,mergeConfig:e}=a;this.artifact=t,this.config=e(t,{particleCount:15,maxSpawnDistance:5,maxSpawnWaitTime:20,fallSpeed:1}),this.originalBlobs=[],this.activeBlobs=[],this.mixers=[]}afterLoadModel(t){var i=this,{engine:s}=t;this.engine=s;for(var r=s.model.getObjectByName("icePoop"),o=a.findByName(s.animations,"Anim_0"),n=function(a){var t=r.clone(),s=t.children[0].children[0].material.clone();s.transparent=!0,t.traverse((a=>{a.isMesh&&(a.material=s)}));var n=new e(t),c=n.clipAction(o);c.clampWhenFinished=!0,t.userData.clip=c,n.addEventListener("finished",(()=>{n.animOver=!0})),i.activeBlobs.push(t),i.engine.scene.add(t),i.mixers.push(n)},c=0;c<this.config.particleCount;c++)n();r.visible=!1}afterSpawnModel(){this.activeBlobs.forEach(((a,e)=>{var i=0===e?0:this.config.maxSpawnWaitTime;a.userData.clip.setLoop(t,1).startAt(Math.random()*i).play(),this.resetBlobStartPosition(a)}))}resetBlobStartPosition(a){var t=Math.random()>.5?1:-1,e=Math.random()*this.config.maxSpawnDistance*t,i=Math.random()>.5?1:-1,s=(1+Math.random()*this.config.maxSpawnDistance)*i;a.position.x=e,a.position.y=-.9,a.position.z=s,a.traverse((a=>{a.isMesh&&(a.material.opacity=1)}));var r=Math.floor(360*Math.random());a.rotation.set(0,r,0);var o=.03*Math.random()+.01;a.scale.set(o,o,o)}tick(a){for(var t=this,{delta:e}=a,i=function(a){var i=t.mixers[a];i.update(e);var s=t.activeBlobs[a];if(i.animOver){var r=s.children[0].children[0];if(s.scale.y>.1&&r.material.opacity>0){var o=s.scale.x+1e-4,n=Math.max(1e-6,s.scale.y-1e-4),c=s.scale.z+1e-4;s.scale.set(o,n,c),r.material.opacity>0&&s.traverse((a=>{a.isMesh&&(a.material.opacity-=.001)}))}else r.material.opacity>0?s.traverse((a=>{a.isMesh&&(a.material.opacity-=.001)})):(s.position.z=1e3,setTimeout((()=>{i.animOver=!1,i._actions.forEach((a=>{a.reset()})),t.resetBlobStartPosition(s)}),10))}},s=0;s<this.mixers.length;s++)i(s)}}export{i as default};
