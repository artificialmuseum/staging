import{a$ as a,ai as e,aj as t}from"../vendor.js";class i{constructor(a){var{artifact:e,mergeConfig:t}=a;this.artifact=e,this.config=t(e,{particleCount:10,maxSpawnDistance:10,maxSpawnWaitTime:20,fallSpeed:1}),this.originalBlobs=[],this.activeBlobs=[],this.mixers=[]}afterLoadModel(i){var s=this,{engine:r}=i;this.engine=r;for(var n=r.model.getObjectByName("icePoop"),o=a.findByName(r.animations,"Anim_0"),c=function(a){var i=n.clone(),r=i.children[0].children[0].material.clone();r.transparent=!0,i.traverse((a=>{a.isMesh&&(a.material=r)}));var c=new e(i),l=c.clipAction(o);l.clampWhenFinished=!0;var m=0===a?0:s.config.maxSpawnWaitTime;l.setLoop(t,1).startAt(Math.random()*m).play(),c.addEventListener("finished",(()=>{c.animOver=!0})),s.activeBlobs.push(i),s.engine.scene.add(i),s.mixers.push(c),s.resetBlobStartPositions(i)},l=0;l<this.config.particleCount;l++)c(l);n.visible=!1}resetBlobStartPositions(a){var e=Math.random()>.5?1:-1,t=Math.random()*this.config.maxSpawnDistance*e,i=-1*(1+Math.random()*this.config.maxSpawnDistance);a.position.set(t,0,i),a.traverse((a=>{a.isMesh&&(a.material.opacity=1)}));var s=Math.floor(360*Math.random());a.rotation.set(0,s,0);var r=.03*Math.random()+.01;a.scale.set(r,r,r)}tick(a){for(var e=this,{delta:t}=a,i=function(a){var i=e.mixers[a];i.update(t);var s=e.activeBlobs[a];if(i.animOver){var r=s.children[0].children[0];if(s.scale.y>.1&&r.material.opacity>0){var n=s.scale.x+1e-4,o=Math.max(1e-6,s.scale.y-1e-4),c=s.scale.z+1e-4;s.scale.set(n,o,c),r.material.opacity>0&&s.traverse((a=>{a.isMesh&&(a.material.opacity-=.001)}))}else r.material.opacity>0?s.traverse((a=>{a.isMesh&&(a.material.opacity-=.001)})):(s.position.y=1e3,setTimeout((()=>{i.animOver=!1,i._actions.forEach((a=>{a.reset()})),e.resetBlobStartPositions(s)}),10))}},s=0;s<this.mixers.length;s++)i(s)}}export{i as default};
