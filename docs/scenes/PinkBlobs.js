import{a$ as a,ai as e,aj as i}from"../vendor.js";class t{constructor(a){var{artifact:e,mergeConfig:i}=a;this.artifact=e,this.config=i(e,{particleCount:8,maxSpawnDistance:10,maxSpawnWaitTime:20,fallSpeed:1}),this.originalBlobs=[],this.activeBlobs=[],this.mixers=[]}afterLoadModel(t){var s=this,{engine:r}=t;this.engine=r;for(var n=r.model.getObjectByName("icePoop"),o=a.findByName(r.animations,"Anim_0"),c=function(a){var t=n.clone(),r=t.children[0].children[0].material.clone();r.transparent=!0,t.traverse((a=>{a.isMesh&&(a.material=r)}));var c=new e(t),l=c.clipAction(o);l.clampWhenFinished=!0,l.setLoop(i,1).startAt(Math.random()*s.config.maxSpawnWaitTime).play(),c.addEventListener("finished",(()=>{c.animOver=!0})),s.activeBlobs.push(t),s.engine.scene.add(t),s.mixers.push(c),s.resetBlobStartPositions(t)},l=0;l<this.config.particleCount;l++)c();n.visible=!1}resetAnimClip(a,e){a.animOver=!1,a._actions.forEach((a=>{a.time=0,a.reset()})),this.resetBlobStartPositions(e)}resetBlobStartPositions(a){var e=Math.random()>.5?1:-1,i=Math.random()*this.config.maxSpawnDistance*e,t=.5+Math.random()*this.config.maxSpawnDistance*-1;a.position.set(i,0,t),a.traverse((a=>{a.isMesh&&(a.material.opacity=1)}));var s=Math.floor(360*Math.random());a.rotation.set(0,s,0);var r=.03*Math.random()+.01;a.scale.set(r,r,r)}tick(a){for(var e=this,{delta:i}=a,t=function(a){var t=e.mixers[a];t.update(i);var s=e.activeBlobs[a];if(t.animOver)if(s.scale.y>1e-5){var r=s.scale.x+1e-4,n=Math.max(1e-6,s.scale.y-1e-4),o=s.scale.z+1e-4;s.scale.set(r,n,o),s.traverse((a=>{a.isMesh&&(a.material.opacity-=2e-4)}))}else{s.children[0].children[0].material.opacity>0?s.traverse((a=>{a.isMesh&&(a.material.opacity-=.001)})):(s.position.y=1e3,setTimeout((()=>e.resetAnimClip(t,s)),10))}},s=0;s<this.mixers.length;s++)t(s)}}export{t as default};
