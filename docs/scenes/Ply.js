import{X as e,aB as a,c as o,W as i,a0 as t,az as l,_ as r,aA as s,a as n,aV as f}from"../vendor.js";class p{constructor(o){var{artifact:i,mergeConfig:t}=o;this.config=t(i.ply,{blending:e,depthTest:!1,file:i.slug,materials:["yellow"],positionOffset:.05,size:1,sizeAttenuation:0,scaleOffset:.01,opacity:"1.0",fallbackAlphaDivisor:3,vertexColors:!1}),this.model=new a}preload(e){var a=this;return o((function*(){var{preload:o}=e,{file:t}=a.config;t.startsWith("/")||(t="".concat(i.STATIC_URL,"/ply/").concat(t,".ply")),t.endsWith(".ply")||(t+=".ply");var l=o.plyLoader;a.geo=yield o.promisifiedLoad({loader:l,file:t})}))()}beforeLoadModel(e){var{engine:a}=e,{blending:o,depthTest:p,materials:c,size:d,sizeAttenuation:u,positionOffset:v,scaleOffset:h,opacity:m,fallbackAlphaDivisor:g,vertexColors:y}=this.config;if(y){var z=new f({vertexColors:y,size:d,sizeAttenuation:u,opacity:m,transparent:"1.0"!==m});console.log("ply",z);var A=new s(this.geo,z);this.model.add(A)}else{var x={fragmentShader:"precision highp float;\n#define GLSLIFY 1\nuniform vec3 uColor;uniform float uAlpha;void main(){vec4 col=vec4(uColor,uAlpha);gl_FragColor=col;}",vertexShader:"precision highp float;\n#define GLSLIFY 1\nuniform float uSize;void main(){gl_PointSize=uSize;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",depthTest:p,blending:o,uniforms:{uSize:{value:d*i.pxRatio,type:"f"},uColor:{value:new t(16711680),type:"f3"},uAlpha:{value:1,type:"f"}}},C=a.XR?1:g,S=new l(r(r({},x),{},{uniforms:r({},x.uniforms)})),w=new s(this.geo,S);c.forEach(((e,a)=>{var o=m;if(n.arr(e)){var[i,l=m]=e;o=l,e=i}o=(parseFloat(o)/C).toFixed(2).toString();var r=w.clone();r.material=r.material.clone(),r.material.uniforms.uColor.value=new t(e),r.material.uniforms.uAlpha.value=o;var s=1+a*h;r.scale.set(s,s,s),r.position.x=a*v,this.model.add(r)}))}}}export{p as default};
