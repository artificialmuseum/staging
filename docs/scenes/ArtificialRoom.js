import{c as t,$ as e}from"../vendor.js";class i{constructor(t){var{artifact:e,mergeConfig:i}=t;this.artifact=e,this.config=i(e,{apiHost:"localhost:2351"}),this.hasVoted=!1}afterLoadModel(t){var{engine:e,preload:i}=t;this.engine=e,this.preload=i,this.gChar=e.model.getObjectByName("cyborg_gameover"),this.rChar=e.model.getObjectByName("cyborg_replay"),this.bunny=e.model.getObjectByName("bunny"),this.bunny.visible=!1}afterVote(e){var i=this;return t((function*(){if(i.hasVoted=!0,i.vote=e,0===i.vote){i.engine.actions.find((t=>"clippDoor_opens"===t._clip.name)).paused=!1;var t=i.engine.actions.find((t=>"landing"===t._clip.name));t.paused=!1}else if(1===i.vote){i.bunny.visible=!0;var n=i.engine.actions.find((t=>"location"===t._clip.name));n.paused=!1;var a=i.engine.actions.find((t=>"shapekeys"===t._clip.name));a.paused=!1}}))()}distanceMatch(t){var{distance:i,config:n,node:a}=t,{min:o=0,max:s}=n.distance;if(i<=s&&i>=o){if(!this.trackedNode){this.trackedNode=a;var[c]=a.name.split("_");this.voteButton&&e.remove(this.voteButton),this.trackedAction=this.engine.actions.find((t=>t._clip.name==="active_".concat(c))),this.trackedAction.paused=!1,this.hasVoted||(this.voteButton=e.create("button",{id:c,on:{click:t=>{var i="gameover"===t.target.id?0:1;e.create("img",{src:"http://".concat(this.config.apiHost,"/v1/vote?").concat(i),parent:document.body,on:{error:t=>{e.remove(t.target),e.remove(this.voteButton),this.afterVote(i)}}})}},innerText:"Vote for ".concat(a.name.split("_")[0]),parent:this.engine.hud.gui}))}}else this.trackedNode&&a.name===this.trackedNode.name&&(this.trackedNode=null,e.remove(this.voteButton),this.voteButton=null,this.trackedAction&&(this.trackedAction.paused=!0,this.trackedAction=null))}tick(){this.engine.modelSpawned}}export{i as default};
