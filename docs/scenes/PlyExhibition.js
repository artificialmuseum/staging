import{am as e,a as t}from"../vendor.js";class i{constructor(e){var{artifact:t,mergeConfig:i,preload:a}=e;this.artifact=t,this.preload=a,this.config=i(t.ply,{clickables:!1,fadeSpeed:1,targetName:"target_"}),this.currentPly=!1}afterLoadModel(e){var{engine:t,preload:i}=e;this.engine=t,this.audioElements=i.assets.audioElements,this.points=t.model.getObjectByName("plyGroup"),console.log(this.points),this.points.children.forEach((e=>{var i,a="".concat(this.config.targetName).concat(e.geometry.name),o=t.model.getObjectByName(a);if(o){var{x:s,y:l,z:n}=o.position;e.position.set(s,l,n);var{x:r,y:c,z:m}=o.rotation;e.rotation.set(r,c,m);var{x:h,y:d,z:p}=o.scale;e.scale.set(h,d,p)}null!==(i=this.config.clickables)&&void 0!==i&&i.length&&(e.material.transparent=!0,e.material.opacity=0,e.visible=!1)}))}onTouch(e){e.forEach((e=>{var{node:t}=e,i=t.name.split("_").pop(),a=this.points.children.find((e=>e.geometry.name===i));this.currentPly!==a&&(this.currentPly=a)}))}tick(i){var a,{delta:o}=i;if(this.engine.modelSpawned&&null!==(a=this.config.clickables)&&void 0!==a&&a.length){var s=this.config.fadeSpeed*o;this.points.children.forEach(((i,a)=>{var o,l,{material:n}=i;if(null!==(o=this.audioElements)&&void 0!==o&&o.length){var{ele:r}=this.audioElements.find((e=>e.config.audio===i.geometry.name));l=r}if(this.currentPly!==i){if(n.opacity>0?n.opacity-=1.3*s:i.visible&&(i.visible=!1),l)if(!e&&l.volume>0){var c=Math.max(0,l.volume-1.3*s);t.fn(l.setVolume)?l.setVolume(c):l.volume=c}else l.pause(),l.currentTime=0}else if(i.visible||(i.visible=!0),n.opacity<1&&(n.opacity+=.8*s),l&&(l.paused&&l.play(),!e&&l.volume<1)){var m=Math.min(1,l.volume+.8*s);t.fn(l.setVolume)?l.setVolume(m):l.volume=m}}))}}}export{i as default};
