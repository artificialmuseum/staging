class e{constructor(e){var{artifact:t,mergeConfig:a,preload:i}=e;this.artifact=t,this.preload=i,this.config=a(t.ply,{fadeSpeed:1,targetName:"target_"}),this.currentPly=!1}afterLoadModel(e){var{engine:t,preload:a}=e;this.engine=t,this.audioElements=a.assets.audioElements,this.points=t.model.getObjectByName("plyGroup"),this.points.children.forEach((e=>{var a="".concat(this.config.targetName).concat(e.geometry.name),i=t.model.getObjectByName(a);if(i){var{x:o,y:r,z:s}=i.position;e.position.set(o,r,s);var{x:n,y:l,z:c}=i.rotation;e.rotation.set(n,l,c);var{x:m,y:p,z:d}=i.scale;e.scale.set(m,p,d)}e.material.transparent=!0,e.material.opacity=0}))}onTouch(e){e.forEach((e=>{var{node:t}=e,a=t.name.split("_").pop(),i=this.points.children.find((e=>e.geometry.name===a));this.currentPly!==i&&(this.currentPly=i)}))}tick(e){var{delta:t}=e;if(this.engine.modelSpawned){var a=this.config.fadeSpeed*t;this.points.children.forEach(((e,t)=>{var{material:i}=e,{ele:o}=this.audioElements.find((t=>t.config.audio===e.geometry.name));if(this.currentPly!==e){if(i.opacity>0&&(i.opacity-=1.3*a),o)if(o.volume>0){var r=Math.max(0,o.volume-1.3*a);is.fn(o.setVolume)?o.setVolume(r):o.volume=r}else o.pause(),o.currentTime=0}else if(i.opacity<1&&(i.opacity+=.8*a),o&&(o.paused&&o.play(),o.volume<1)){var s=Math.min(1,o.volume+.8*a);is.fn(o.setVolume)?o.setVolume(s):o.volume=s}}))}}}export{e as default};
